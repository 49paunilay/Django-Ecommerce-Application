<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
      body{
        background-image: url('https://th.bing.com/th/id/Refcbcd73356627f26192298682d60262?rik=e228I4m1oghSBg&riu=http%3a%2f%2fwww.pixelstalk.net%2fwp-content%2fuploads%2f2016%2f03%2fPicture-sunset-wallpaper-HD.jpg&ehk=1w9j1HmOYPvOc%2bE2b9JRD5sUEvMme8G0teHlqKuuWgM%3d&risl=&pid=ImgRaw');
      }
      .userinput{
        color: aliceblue;
      }
    </style>
    <title>Cart Details</title>
  </head>
  <body>
    <div class="container" style="text-align: center;">
      <h5 style="color: aliceblue;">
        Check out
      </h5>
    </div>
      <div class="container">
        <div class="row">
          <div class="col-md-12">
              
                <ul id="item-checkout" class="list-group" style="text-align: center;">

                </ul>
              </div>
          </div>
      </div>

      <div class="container" style="margin-top: 20px;">
        <div class="row">
          <div class="col-md-12">
            <form class="needs-validation" method="POST">
              {% csrf_token %}

              <input type="hidden" id="items" name="items">



              <div class="form-row">
                <div class="col-md-4 mb-3">
                  <label class="userinput" for="validationCustom01">First name</label>
                  <input type="text" class="form-control" id="first_name" name="first_name" placeholder="First name"  required>
                  <div class="valid-feedback">
                    Looks good!
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="userinput" for="validationCustom02">Last name</label>
                  <input type="text" class="form-control" id="last_name" name="last_name" placeholder="Last name"  required>
                  <div class="valid-feedback">
                    Looks good!
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="userinput" for="email">Enter your mail address</label>
                  <input type="email" class="form-control" id="Email" name="Email" placeholder="Email"  required>
                  <div class="valid-feedback">
                    Looks good!
                  </div>
                </div>

                <div class="col-md-4 mb-3">
                  <label class="userinput" for="validationCustomUsername">Username</label>
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text" id="inputGroupPrepend">@</span>
                    </div>
                    <input type="text" class="form-control" id="username" name="username" placeholder="Username" aria-describedby="inputGroupPrepend" required>
                    <div class="invalid-feedback">
                      Please choose a username.
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="col-md-6 mb-3">
                  <label class="userinput" for="validationCustom03">City</label>
                  <input type="text" class="form-control" id="city" name="city" placeholder="City" required>
                  <div class="invalid-feedback">
                    Please provide a valid city.
                  </div>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="userinput" for="validationCustom04">State</label>
                  <input type="text" class="form-control" id="state" name="state" placeholder="State" required>
                  <div class="invalid-feedback">
                    Please provide a valid state.
                  </div>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="userinput" for="validationCustom05">Zip</label>
                  <input type="text" class="form-control" id="zip" name="zip" placeholder="Zip" required>
                  <div class="invalid-feedback">
                    Please provide a valid zip.
                  </div>
                </div>

                <div class="col-md-3 mb-3">
                  <label class="userinput" class="priceInput">Price to be paid</label>
                  <input readonly class="form-control" id="total" name="total" type="text">
                </div>

              </div>
              <button class="btn btn-primary" id="submitbutton" type="submit">Order Now</button>
            </form>
            
            <script>
            // Example starter JavaScript for disabling form submissions if there are invalid fields
            (function() {
              'use strict';
              window.addEventListener('load', function() {
                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = document.getElementsByClassName('needs-validation');
                // Loop over them and prevent submission
                var validation = Array.prototype.filter.call(forms, function(form) {
                  form.addEventListener('submit', function(event) {
                    if (form.checkValidity() === false) {
                      event.preventDefault();
                      event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                  }, false);
                });
              }, false);
            })();
            </script>
            
  
  
  
          </div>
        </div>
      </div>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script type="text/javascript">
    let button = document.getElementById('submitbutton')
    const handleSubmit=()=>{
      localStorage.clear();
      console.log(localStorage.getItem('cart'))
    }
    button.addEventListener('click',handleSubmit)
    </script>
    <script type="text/javascript">
        if(localStorage.getItem('cart')===null){
          cart={}
        }else{
          cart = JSON.parse(localStorage.getItem('cart'))
        }
        console.log(cart)
        let total_price = 0
        for(item in cart){
          let name = cart[item][1]
          let quantity = cart[item][0]
          let price = cart[item][2]
          total_price+=price
          itemString = `<li class="list-group-item"><span >${name} </span> <span>${quantity} </span> <span style="color:red !important" class="badge badge-warning">${price}</span></li>`

          $('#item-checkout').append(itemString)

        }
        totalPriceString = `<li class="list-group-item">Total Price ${total_price} INR<strong></strong></li>`
        $('#total').val(total_price)
        $('#item-checkout').append(totalPriceString)
        $('#items').val(JSON.stringify(cart))
    </script>
  </body>
</html>